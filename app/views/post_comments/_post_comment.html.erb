
<div class="post_comment_block">
    <%owner_user = find_owner_user(post_comment.user_id)%>
    <div class="post_comment_left_block">
        <div class="post_comment_avatar checked_<%=find_user_color(owner_user.name)%>">
            <a><%= link_to owner_user.name[0], user_session_path(owner_user), class: "post_comment_name_label"%></a>
        </div>
    </div>
    <div class="post_comment_right_block">
        <div class="post_comment_right">
            <div class="post_comment_info">
                <a><%=owner_user.name%></a> · 
                <span><%=time_ago_in_words(post_comment.created_at)%></span>
            </div>
            <div class="post_comment_cotent">
                <a><%= post_comment.content %></a>
            </div>

            <div class="post_comment_reply_toolbar">
                <div class="post_comment_index_vote_unvote_block">
                    <div class="post_comment_index_vote_block" id="post_comment_index_vote_<%=post_comment.id%>">
                        <%if current_user.present?%>
                            <% pre_comment_vote = post_comment.post_comment_votes.find { |vote| vote.user_id == current_user.id} %>
                        <%end%>
                        <% if pre_comment_vote %>  
                            <%= button_to post_post_comment_post_comment_vote_path(post_comment, pre_comment_vote), method: :delete, remote: true do%>
                                <i><%= bootstrap_icon "arrow-up-circle-fill", width: 20, height: 20, fill: "#4f46e5" %></i>
                            <%end%> 
                        <%else%>
                            <%= button_to post_post_comment_post_comment_votes_path(@post, post_comment), method: :post, remote: true do%>
                                <i><%= bootstrap_icon "arrow-up-circle", width: 20, height: 20, fill: "#888" %></i>
                            <%end%> 
                        <%end%>
                    </div>

                    <div class="post_comment_index_vote_unvote_count">
                        <span><%=post_comment.post_comment_votes.count - post_comment.post_comment_unvotes.count%></span>
                    </div>

                    <div class="post_comment_index_unvote_block" id="post_comment_index_unvote_<%=post_comment.id%>">
                        <%if current_user.present?%>
                            <% pre_comment_unvote = post_comment.post_comment_unvotes.find { |vote| unvote.user_id == current_user.id} %>
                        <%end%>
                        <% if pre_comment_unvote %>  
                            <%= button_to post_post_comment_post_comment_unvote_path(post_comment, pre_comment_unvote), method: :delete, remote: true do%>
                                <i><%= bootstrap_icon "arrow-down-circle-fill", width: 20, height: 20, fill: "#4f46e5" %></i>
                            <%end%> 
                        <%else%>
                            <%= button_to post_post_comment_post_comment_unvotes_path(@post, post_comment), method: :post, remote: true do%>
                                <i><%= bootstrap_icon "arrow-down-circle", width: 20, height: 20, fill: "#888" %></i>
                            <%end%> 
                        <%end%>
                    </div>
                </div>
                <div class="post_comment_reply_block">
                    <%if user_signed_in?%>
                        <button class="post_comment_reply_btn" onclick="myFunctionReplyPostComment(<%=post_comment.id%>)">
                            <i><%= bootstrap_icon "reply", width: 22, height: 22, fill: "#4f46e5" %></i>
                            <span><%= post_comment.post_comments.count%></span> 
                            <a>Trả lời</a> 
                        </button>
                    <%end%>
                </div>
            </div>

            <div class="post_reply_comment_new">
                <%= form_for([post_comment, PostComment.new], remote: true) do |f| %>
                    <div class="post_reply_comment_section">
                        <div class="post_reply_comment_input">
                            <%= f.text_area :content, :required =>true, class: "form-control", placeholder: "Nhập trả lời tại đây" %>
                        </div>
                        <div class="post_reply_comment_submit">
                            <%= f.submit "Trả lời", class: "post_reply_comment_form_submit" %>
                        </div>
                    </div>
                <%end%>
            </div>
            
            <div class="post_comment_reply_container">
                <div class="post_reply_comment_render" id="post_reply_comment_index_<%=post_comment.id%>">
                    <%= render post_comment.post_comments %>
                </div>
            </div>
        </div>
    </div>

    <script>
        function myFunctionReplyPostComment(id) {
            var x = document.getElementById(id);
            if (x.style.display == "block") 
            {
                x.style.display = "none";
            } 
            else 
            {
                x.style.display = "block";
            }
        }
    </script>
</div>