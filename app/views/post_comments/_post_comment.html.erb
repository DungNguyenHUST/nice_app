
<div class="post_comment_block">
    <%@owner_post_comment_user = find_owner_user_for_post_comment(post_comment)%>
    <div class="post_comment_left_block">
        <%if @owner_post_comment_user.avatar?%>
            <div class="post_comment_user_avatar">
                <%= link_to (image_tag(@owner_post_comment_user.avatar.url)), image_path(url_for(@owner_post_comment_user.avatar.url)), rel: "gallery" , :href => user_path(@owner_post_comment_user)%>
            </div>
        <%else%>
            <div class="post_comment_user_avatar">
                <%= link_to (image_tag("default-user.png")), image_path(url_for("default-user.png")), rel: "gallery" , :href => user_path(@owner_post_comment_user)%>
            </div>
        <%end%>
    </div>
    <div class="post_comment_right_block">
        <div class="post_comment_info">
            <a><%=@owner_post_comment_user.name%></a> · 
            <span><%=time_ago_in_words(post_comment.created_at)%></span>
        </div>
        <div class="post_comment_right">
            <div class="post_comment_cotent">
                <a><%= post_comment.content %></a>
            </div>

            <div class="post_comment_right_toolbar">
                <div class="post_comment_vote_unvote_block" id="post_comment_vote_unvote_<%=post_comment.id%>">
                    <div class="post_comment_vote_block">
                        <%if user_signed_in?%>
                            <% pre_comment_vote = post_comment.post_comment_votes.find { |vote| vote.user_id == current_user.id} %>
                        <%end%>
                        <% if pre_comment_vote %>  
                            <%= button_to post_comment_post_comment_vote_path(post_comment, pre_comment_vote), method: :delete, remote: true, form_class: "btn_highlight" do%>
                                <i><%= bootstrap_icon "shift-fill", width: 19, height: 19%></i>
                            <%end%> 
                        <%else%>
                            <%= button_to post_comment_post_comment_votes_path(post_comment), method: :post, remote: true, form_class: "btn_normal" do%>
                                <i><%= bootstrap_icon "shift", width: 19, height: 19%></i>
                            <%end%> 
                        <%end%>
                    </div>

                    <div class="post_comment_vote_unvote_count">
                        <span><%=convert_number_to_human(post_comment.post_comment_votes.count - post_comment.post_comment_unvotes.count)%></span>
                    </div>

                    <div class="post_comment_unvote_block">
                        <%if user_signed_in?%>
                            <% pre_comment_unvote = post_comment.post_comment_unvotes.find { |unvote| unvote.user_id == current_user.id} %>
                        <%end%>
                        <% if pre_comment_unvote %>  
                            <%= button_to post_comment_post_comment_unvote_path(post_comment, pre_comment_unvote), method: :delete, remote: true, form_class: "btn_highlight" do%>
                                <i><%= bootstrap_icon "shift-fill", width: 19, height: 19%></i>
                            <%end%> 
                        <%else%>
                            <%= button_to post_comment_post_comment_unvotes_path(post_comment), method: :post, remote: true, form_class: "btn_normal" do%>
                                <i><%= bootstrap_icon "shift", width: 19, height: 19%></i>
                            <%end%> 
                        <%end%>
                    </div>
                </div>
                
                <div class="post_comment_reply_block">
                    <%if user_signed_in?%>
                        <button class="post_comment_reply_btn" onclick="myFunctionReplyPostComment('post_comment_input_reply_' + <%=post_comment.id.to_s%>)">
                            <i><%= bootstrap_icon "chat", width: 17, height: 17%></i>
                            <span><%= convert_number_to_human(post_comment.post_comments.count)%></span>
                        </button>
                    <%else%>
                        <%= button_to new_user_session_path, :method => :get, form_class: "post_comment_reply_btn" do%>
                            <i><%= bootstrap_icon "chat", width: 17, height: 17%></i>
                            <span><%= convert_number_to_human(post_comment.post_comments.count)%></span>
                        <%end%>
                    <%end%>
                </div>

                <div class='post_comment_action_block'>
                    <button class="post_comment_option_btn" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i><%= bootstrap_icon "three-dots-vertical", width: 16, height: 16%></i>
                    </button>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                        <div class="dropdown-item">
                            <button type="button" class="btn" data-toggle="modal" data-target="#buttonCommentModalCenter">
                                Báo xấu
                            </button>
                        </div>
                    </div>
                    <!-- Modal -->
                    <div class="modal fade" id="buttonCommentModalCenter" tabindex="-1" role="dialog" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <%@post_comment = post_comment%>
                                <%= render :partial => 'post_comment_reports/form', object: @post_comment %>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="post_reply_comment_new" id="post_comment_input_reply_<%=post_comment.id.to_s%>">
                <%= form_for([post_comment, PostComment.new], remote: true) do |f| %>
                    <div class="post_reply_comment_section">
                        <div class="post_reply_comment_input">
                            <%= f.text_area :content, :required =>true, class: "form-control", placeholder: "Nhập trả lời tại đây" %>
                        </div>
                        <div class="post_reply_comment_submit">
                            <%= f.submit "Trả lời", class: "post_reply_comment_form_submit" %>
                        </div>
                    </div>
                <%end%>
            </div>
            
            <div class="post_comment_reply_container">
                <div class="post_reply_comment_render" id="post_reply_comment_index_<%=post_comment.id%>">
                    <%= render post_comment.post_comments%>
                </div>
            </div>
        </div>
    </div>

    <script>
        function myFunctionReplyPostComment(id) {
            var x = document.getElementById(id);
            if (x.style.display == "block") 
            {
                x.style.display = "none";
            } 
            else 
            {
                x.style.display = "block";
            }
        }
    </script>
</div>