<div class="topic_show_container">
    <div class="container">
        <div class="row">
            <div class="col-sm-12 col-nopadding">
                <div class='topic_show_info'>
                    <%if @topic.cover_image?%>
                        <div class='topic_show_info_cover'>
                            <%= link_to (image_tag(@topic.cover_image.url)), image_path(url_for(@topic.cover_image.url)), rel: "gallery" , :href => topic_path(@topic)%>
                        </div>
                    <%else%>
                        <div class='topic_show_info_cover'>
                            <%= link_to (image_tag("default-cover.jpg")), image_path(url_for("default-cover.jpg")), rel: "gallery" , :href => topic_path(@topic)%>
                        </div>
                    <%end%>

                    <%if @topic.avatar?%>
                        <div class='topic_show_info_avatar'>
                            <%= link_to (image_tag(@topic.avatar.url)), image_path(url_for(@topic.avatar.url)), rel: "gallery" , :href => topic_path(@topic)%>
                        </div>
                    <%else%>
                        <div class='topic_show_info_avatar'>
                            <%= link_to (image_tag("default-avartar.jpg")), image_path(url_for("default-avartar.jpg")), rel: "gallery" , :href => topic_path(@topic)%>
                        </div>
                    <%end%>

                    <div class='topic_show_info_data'>
                        <div class='topic_show_info_title'>
                            <a><%=@topic.name%></a>
                        </div>
                        <div class='topic_show_info_count'>
                            <a><%= @topic.posts.count %> bài viết</a><span> · </span>
                            <a><%= @topic.topic_follows.count %> người theo dõi</a>
                        </div>
                        <div class='topic_show_info_des'>
                            <a><%=@topic.description%></a>
                        </div>
                    </div>

                    <div class="topic_show_action_block">
                        <div class="topic_show_follow_block" id="topic_follow_<%=@topic.id%>">
                            <%if user_signed_in?%>
                                <% pre_follow = @topic.topic_follows.find { |follow| follow.user_id == current_user.id} %>
                                <% if pre_follow %>  
                                    <%= button_to topic_topic_follow_path(@topic, pre_follow), method: :delete, remote: true , form_class: "btn_highlight" do%>
                                        <a>Đang theo dõi</a>
                                    <%end%> 
                                <%else%>
                                    <%= button_to topic_topic_follows_path(@topic), method: :topic, remote: true, form_class: "btn_normal" do%>
                                        <a>Theo dõi</a>
                                    <%end%> 
                                <%end%>
                            <%else%>
                                <button type="button" class="btn_normal" data-toggle="modal" data-target="#buttonModalLoginCenter">
                                    <a>Theo dõi</a>
                                </button>
                            <%end%>
                        </div>

                        <div class='topic_show_info_action'>
                            <button class="topic_show_option_btn" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i><%= bootstrap_icon "three-dots-vertical", width: 18, height: 18%></i>
                            </button>
                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                                <div class="dropdown-item">
                                    <%if user_signed_in?%>
                                        <button type="button" class="btn" data-toggle="modal" data-target="#buttonModalCenter">
                                            Báo xấu
                                        </button>
                                    <%else%>
                                        <button type="button" class="btn" data-toggle="modal" data-target="#buttonModalLoginCenter">
                                            Báo xấu
                                        </button>
                                    <%end%>
                                </div>
                            </div>
                            <!-- Modal -->
                            <div class="modal fade" id="buttonModalCenter" tabindex="-1" role="dialog" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered" role="document">
                                    <div class="modal-content">
                                        <%= render :partial => 'topic_reports/form', object: @topic %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-8 col-nopadding">
                <div class='topic_show_middle'>
                    <div class="topic_show_post_sort">
                        <div class="topic_show_post_tab_link">
                            <ul class="nav">
                                <li class="nav-item">
                                    <%if @tab_id == "default" || @tab_id == "TopicPostForYou"%>
                                        <%active = "active"%>
                                    <%else%> 
                                        <%active = ""%>
                                    <%end%>
                                    <a class="nav-link <%=active%>" href="<%=topic_path(@topic, tab_id: 'TopicPostForYou')%>"><i><%= bootstrap_icon "megaphone", width: 18, height: 18%></i>For U </a>
                                </li>
                                <li class="nav-item">
                                    <%if @tab_id == "TopicPostTrendID"%>
                                        <%active = "active"%>
                                    <%else%> 
                                        <%active = ""%>
                                    <%end%>
                                    <a class="nav-link <%=active%>" href="<%=topic_path(@topic, tab_id: 'TopicPostTrendID')%>"><i><%= bootstrap_icon "arrow-up-right-square", width: 18, height: 18%></i>Trending </a>
                                </li>
                                <li class="nav-item">
                                    <%if @tab_id == "TopicPostNewID"%>
                                        <%active = "active"%>
                                    <%else%> 
                                        <%active = ""%>
                                    <%end%>
                                    <a class="nav-link <%=active%>" href="<%=topic_path(@topic, tab_id: 'TopicPostNewID')%>"><i><%= bootstrap_icon "lightning", width: 18, height: 18%></i>Mới nhất </a>
                                </li>
                                <li class="nav-item">
                                    <%if @tab_id == "TopicPostTopID"%>
                                        <%active = "active"%>
                                    <%else%> 
                                        <%active = ""%>
                                    <%end%>
                                    <a class="nav-link <%=active%>" href="<%=topic_path(@topic, tab_id: 'TopicPostTopID')%>"><i><%= bootstrap_icon "shift", width: 19, height: 19%></i>Top </a>
                                </li>
                                <%if @tab_id == "TopicPostTopID" || @tab_id == "TopicPostTopWeekID" || @tab_id == "TopicPostTopMonthID" || @tab_id == "TopicPostTopYearID"%>
                                    <li class="nav-item">
                                        <%if @tab_id == "TopicPostTopWeekID"%>
                                            <%active = "active"%>
                                        <%else%> 
                                            <%active = ""%>
                                        <%end%>
                                        <a class="nav-link <%=active%>" href="<%=topic_path(@topic, tab_id: 'TopicPostTopWeekID')%>">Top tuần</a>
                                    </li>
                                    <li class="nav-item">
                                        <%if @tab_id == "TopicPostTopMonthID"%>
                                            <%active = "active"%>
                                        <%else%> 
                                            <%active = ""%>
                                        <%end%>
                                        <a class="nav-link <%=active%>" href="<%=topic_path(@topic, tab_id: 'TopicPostTopMonthID')%>">Top tháng</a>
                                    </li>
                                    <li class="nav-item">
                                        <%if @tab_id == "TopicPostTopYearID"%>
                                            <%active = "active"%>
                                        <%else%> 
                                            <%active = ""%>
                                        <%end%>
                                        <a class="nav-link <%=active%>" href="<%=topic_path(@topic, tab_id: 'TopicPostTopYearID')%>">Top năm</a>
                                    </li>
                                <%end%>
                                <li class="nav-item">
                                    <%if @tab_id == "TopicPostPodID"%>
                                        <%active = "active"%>
                                    <%else%> 
                                        <%active = ""%>
                                    <%end%>
                                    <a class="nav-link <%=active%>" href="<%=topic_path(@topic, tab_id: 'TopicPostPodID')%>"><i><%= bootstrap_icon "mic", width: 19, height: 19%></i>Podcasts </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="topic_show_post_tab_content">
                        <%if @posts.present?%>
                            <div id="topic_show_infinite_scroll">
                                <%= render @posts %>
                            </div>
                            <%if @posts.total_count > 10%>
                                <div class="topic_show_pagination_button" id="topic_show_pagination">
                                    <%= link_to_next_page(@posts, 'Xem thêm', :remote => true) %>
                                </div>
                            <%end%>
                        <%end%>
                    </div>
                </div>
            </div>
            <div class="col-sm-4 col-nopadding">
                <div class='topic_show_right'>
                    <div class='topic_show_right_title'>
                        <a>Bài viết khác về <%=link_to (@topic.name), topic_path(@topic)%></a>
                    </div>
                    <%@posts.each do |post|%>
                        <div class='topic_show_right_post_block'>
                            <a><%= link_to (post.title), post_path(post) %></a>
                        </div>
                        <div class='topic_show_right_topic_block'>
                            <%post.topics.each do |topic|%>
                                <%= button_to topic_path(topic), method: :get do %>
                                    <a><%=topic.name%></a>
                                <%end%>
                            <%end%>
                        </div>
                    <%end%>
                </div>
            </div>
        </div>
    </div>
</div>
