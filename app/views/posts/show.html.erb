<div class='post_show_container'>
	<div class='container'>
		<div class='row'>
			<div class='col-sm-8 col-nopadding'>
				<div class='post_show_left_block'>
				    <div class='post_show_info'>
				        <div class='post_show_info_left'>
							<%@owner_post_user = find_owner_user(@post)%>
							<%if @owner_post_user.avatar?%>
                                <div class="post_show_user_avatar">
                                    <%= link_to (image_tag(@owner_post_user.avatar.url)), image_path(url_for(@owner_post_user.avatar.url)), rel: "gallery" , :href => user_path(@owner_post_user)%>
                                </div>
							<%else%>
								<div class="post_show_user_avatar">
									<%= link_to (image_tag("default-user.png")), image_path(url_for("default-user.png")), rel: "gallery" , :href => user_path(@owner_post_user)%>
                                </div>
							<%end%>
				        </div>
				        <div class='post_show_info_right'>
				            <div class="post_show_user_name">
				                <a><%= link_to @owner_post_user.name, user_path(@owner_post_user)%></a>
				            </div>
				            <div class="post_show_create">
								<span><%=@owner_post_user.created_at.strftime("%B %d")%> · <%=time_ago_in_words(@owner_post_user.created_at)%></span>
				            </div>
				        </div>
				    </div>
				    <div class='post_show_title'>
				        <a><%= @post.title%></a>
				    </div>

					<div class='post_show_tag_link_block'>
						<%@post.tags.each do |tag|%>
							<div class='post_show_tag_link'>
								<a><%= link_to (tag.name), tag_path(tag) %></a>
							</div>
						<%end%>
					</div>

					<%if @post.post_links.count > 0%>
						<%@post.post_links.each do |post_link|%>
							<div class='post_show_link_block'>
								<div class='post_show_link_image'>
									<%= link_to (image_tag(post_link.image.to_s)), image_path(url_for(post_link.image.to_s)), rel: "gallery" , :href => url_for(@post.link), target: :_blank%>
								</div>

								<div class='post_show_link_right'>
									<div class='post_show_link_title'>
										<a><%= link_to post_link.title, url_for(@post.link), target: :_blank%></a>
									</div>
									<div class='post_show_link_description'>
										<a><%= link_to truncate(strip_tags(post_link.description), length: 300), url_for(@post.link), target: :_blank%></a>
									</div>

									<div class='post_show_link_url'>
										<i><%= bootstrap_icon "box-arrow-in-up-right", width: 14, height: 14%></i>
										<a><%= link_to get_domain_name(@post.link.to_s), url_for(@post.link), target: :_blank%></a>
									</div>
								</div>
							</div>
						<%end%>
					<%end%>

					<%if @post.post_images.count > 0 && @post.post_images.count == 1%>
						<%@post.post_images.each do |post_image|%>
							<div class='post_show_image'>
								<%= image_tag(post_image.image.url)%>
							</div>
						<%end%>
					<%elsif @post.post_images.count > 0%>
						<div class='post_show_image'>
							<div id="carouselImageIndicators" class="carousel slide" data-ride="carousel">
								<ol class="carousel-indicators">
									<li data-target="#carouselImageIndicators" data-slide-to="0" class="active"></li>
									<li data-target="#carouselImageIndicators" data-slide-to="1"></li>
									<li data-target="#carouselImageIndicators" data-slide-to="2"></li>
								</ol>
								<div class="carousel-inner">
									<div class="carousel-item active">
										<img class="d-block w-100" src="<%=url_for(@post.post_images.first.image.url)%>">
									</div>
									<%@post.post_images.each do |post_image|%>
										<div class="carousel-item">
											<img class="d-block w-100" src="<%=url_for(post_image.image.url)%>">
										</div>
									<%end%>
								</div>
								<a class="carousel-control-prev" href="#carouselImageIndicators" role="button" data-slide="prev">
									<span class="carousel-control-prev-icon" aria-hidden="true"></span>
									<span class="sr-only">Previous</span>
								</a>
								<a class="carousel-control-next" href="#carouselImageIndicators" role="button" data-slide="next">
									<span class="carousel-control-next-icon" aria-hidden="true"></span>
									<span class="sr-only">Next</span>
								</a>
							</div>
						</div>
					<%end%>

					<%if @post.content_rich_text.present?%>
						<div class='post_show_content'>
							<a><%=@post.content_rich_text%></a>
						</div>
					<%end%>

					<%if @post.post_shared_id?%>
						<div class='post_show_shared'>
							<%@post_shared = Post.friendly.find(@post.post_shared_id)%>
							<%=render @post_shared%>
						</div>
					<%end%>

					<div class="post_show_toolbar_block">
						<div class="post_show_vote_unvote_conatainer">
							<div class="post_show_vote_unvote_block" id="post_vote_unvote_<%=@post.id%>">
								<div class="post_show_vote_block">
									<%if user_signed_in?%>
										<% pre_vote = @post.post_votes.find { |vote| vote.user_id == current_user.id} %>
									<%end%>
									<% if pre_vote %>  
										<%= button_to post_post_vote_path(@post, pre_vote), method: :delete, remote: true, form_class: "btn_highlight" do%>
											<i><%= bootstrap_icon "shift-fill", width: 19, height: 19%></i>
										<%end%> 
									<%else%>
										<%= button_to post_post_votes_path(@post), method: :@post, remote: true, form_class: "btn_normal" do%>
											<i><%= bootstrap_icon "shift", width: 19, height: 19%></i>
										<%end%> 
									<%end%>
								</div>

								<a class="post_show_vote_unvote_count">
									<span><%=convert_number_to_human(@post.post_votes.count - @post.post_unvotes.count)%></span>
								</a>

								<div class="post_show_unvote_block">
									<%if user_signed_in?%>
										<% pre_unvote = @post.post_unvotes.find { |unvote| unvote.user_id == current_user.id} %>
									<%end%>
									<% if pre_unvote %>  
										<%= button_to post_post_unvote_path(@post, pre_unvote), method: :delete, remote: true, form_class: "btn_highlight" do%>
											<i><%= bootstrap_icon "shift-fill", width: 19, height: 19%></i>
										<%end%> 
									<%else%>
										<%= button_to post_post_unvotes_path(@post), method: :@post, remote: true, form_class: "btn_normal" do%>
											<i><%= bootstrap_icon "shift", width: 19, height: 19%></i>
										<%end%> 
									<%end%>
								</div>
							</div>
						</div>

						<div class="post_show_comment_block">
							<%if user_signed_in?%>
                                <button class="post_reply_btn" onclick="myFunctionReplyPost('post_comment_input_' + <%=@post.id.to_s%>)">
									<i><%= bootstrap_icon "chat", width: 18, height: 18%></i>
									<span><%= convert_number_to_human(@post.post_comments.count)%></span>
								</button>
                            <%else%>
                                <%= button_to new_user_session_path, :method => :get, form_class: "post_reply_btn" do%>
                                    <i><%= bootstrap_icon "chat", width: 18, height: 18%></i>
									<span><%= convert_number_to_human(@post.post_comments.count)%></span>
                                <%end%>
                            <%end%>
						</div>

						<div class="post_show_share_block">
							<%= link_to new_post_path(:post_shared_id => @post.id, :tab_id => 'PostID'), method: :get, form_class: "post_show_share" do%>
								<i><%= bootstrap_icon "arrow-repeat", width: 21, height: 21%></i>
								<span><%=@post.share_count.to_s%></span>
							<%end%>  
						</div>

						<div class="post_show_follow_block" id="post_follow_<%=@post.id%>">
							<%if user_signed_in?%>
								<% pre_follow = @post.post_follows.find { |follow| follow.user_id == current_user.id} %>
							<%end%>
							<% if pre_follow %>  
								<%= button_to post_post_follow_path(@post, pre_follow), method: :delete, remote: true, form_class: "btn_highlight" do%>
									<i><%= bootstrap_icon "bookmark-fill", width: 17, height: 17%></i>
								<%end%> 
							<%else%>
								<%= button_to post_post_follows_path(@post), method: :post, remote: true, form_class: "btn_normal" do%>
									<i><%= bootstrap_icon "bookmark", width: 17, height: 17%></i>
								<%end%> 
							<%end%>
						</div>
					</div>

				    <div class="post_show_new_comment_block" id ="post_comment_input_<%=@post.id.to_s%>">
				        <%= form_for([@post, PostComment.new], remote: true) do |f| %>
				            <div class="post_show_comment_section">
				                <div class="post_show_comment_input">
				                    <%= f.text_area :content, :required =>true, class: "form-control", placeholder: "Nhập bình luận của bạn tại đây" %>
				                </div>

				                <div class="post_show_comment_submit">
				                    <%= f.submit "Gửi bình luận", class: "post_show_comment_submit" %>
				                </div>
				            </div>
				        <%end%>
				    </div>
				    
				    <div class="post_show_comment_render" id="post_show_comment_index_<%=@post.id%>">
				        <%= render @post.post_comments%>
				    </div>

				    <script>
						function myFunctionReplyPost(id) {
							var x = document.getElementById(id);
							if (x.style.display == "block") 
							{
								x.style.display = "none";
							} 
							else 
							{
								x.style.display = "block";
							}
						}
					</script>
				</div>
			</div>
			<div class='col-sm-4 col-nopadding'>
				<div class='post_show_right_block_user'>
					<div class='post_show_right_info'>
				        <div class='post_show_right_info_left'>
							<%if @owner_post_user.avatar?%>
                                <div class="post_show_right_user_avatar">
                                    <%= link_to (image_tag(@owner_post_user.avatar.url)), image_path(url_for(@owner_post_user.avatar.url)), rel: "gallery" , :href => user_path(@owner_post_user)%>
                                </div>
							<%else%>
				            	<div class="post_show_right_user_avatar">
									<%= link_to (image_tag("default-user.png")), image_path(url_for("default-user.png")), rel: "gallery" , :href => user_path(@owner_post_user)%>
                                </div>		
							<%end%>
				        </div>
				        <div class='post_show_right_info_right'>
				            <div class="post_show_right_user_name">
								<a><%=link_to (@owner_post_user.name), user_path(@owner_post_user) %></a>
				            </div>
				        </div>
				    </div>

					<div class="post_show_right_user_info_block">
						<div class="post_show_right_user_info">
							<div class="post_show_right_user_info_label">
								<a><i><%= bootstrap_icon "briefcase", width: 20, height: 20%></i>VIỆC LÀM</a>
							</div>
							<div class="post_show_right_user_info_des">
								<%if @owner_post_user.job.present?%>
									<span><%=@owner_post_user.job%></span>
								<%else%>
									<span>---</span>
								<%end%>
							</div>
						</div>

						<div class="post_show_right_user_info">
							<div class="post_show_right_user_info_label">
								<a><i><%= bootstrap_icon "book", width: 20, height: 20%></i>HỌC VẤN</a>
							</div>
							<div class="post_show_right_user_info_des">
								<%if @owner_post_user.school.present?%>
									<span><%=@owner_post_user.school%></span>
								<%else%>
									<span>---</span>
								<%end%>
							</div>
						</div>

						<div class="post_show_right_user_info">
							<div class="post_show_right_user_info_label">
								<a><i><%= bootstrap_icon "geo-alt", width: 20, height: 20%></i>ĐỊA CHỈ</a>
							</div>
							<div class="post_show_right_user_info_des">
								<%if @owner_post_user.address.present?%>
									<span><%=@owner_post_user.address%></span>
								<%else%>
									<span>---</span>
								<%end%>
							</div>
						</div>

						<div class="post_show_right_user_info">
							<div class="post_show_right_user_info_label">
								<a><i><%= bootstrap_icon "calendar", width: 18, height: 18%></i>NGÀY THAM GIA</a>
							</div>
							<div class="post_show_right_user_info_des">
								<span><%=@owner_post_user.created_at.strftime("%B %d, %Y")%></span>
							</div>
						</div>
					</div>
					
					<%if user_signed_in?%>
						<div class="post_show_right_user_follow" id="user_follow_<%=current_user.id%>">
							<% pre_follow = current_user.following_users.find { |follow| follow.followee_id == current_user.id} %>
							<% if pre_follow %>  
								<%= button_to user_user_follow_path(current_user, pre_follow, type_param: "index"), method: :delete, remote: true, form_class: "btn_highlight" do%>
									<a>Đã theo dõi</a>
								<%end%> 
							<%else%>
								<%= button_to user_user_follows_path(current_user, type_param: "index"), method: :post, remote: true, form_class: "btn_normal" do%>
									<a>Theo dõi</a>
								<%end%>
							<%end%>
						</div>
					<%else%>
						<div class="post_show_right_user_follow">
							<%= button_to new_user_session_path, :method => :post do%>
								<a>Theo dõi</a>
							<%end%>
						</div>
					<%end%>
				</div>

	            <div class='post_show_right_user_post'>
                    <div class='post_show_right_title'>
                        <a>Bài viết khác từ <%=link_to (@owner_post_user.name), user_path(@owner_post_user) %></a>
                    </div>
					<%@owner_post = find_owner_post_for_user(@owner_user)%>
                    <%@owner_post.each do |post|%>
                        <div class='post_show_right_content'>
							<div class='post_show_right_post_block'>
                            	<a><%= link_to (post.title), post_path(post) %></a>
							</div>
							<div class='post_show_right_tag_block'>
								<%post.tags.each do |tag|%>
									<%= button_to tag_path(tag), method: :get do %>
										<a><%=tag.name%></a>
									<%end%>
								<%end%>
							</div>
                        </div>
                    <%end%>
                </div>
			</div>
		</div>
	</div>
</div>