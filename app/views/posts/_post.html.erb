<div class='post_index_block'>
    <div class='post_index_info'>
        <%owner_user = find_owner_user_for_post(@post)%>
        <div class='post_index_info_left'>
            <div class="post_index_user_avatar checked_<%=find_user_color(owner_user.name)%>">
                <a><%= link_to owner_user.name[0].upcase, user_session_path(owner_user), class: "post_index_user_name_label"%></a>
            </div>
        </div>
        <div class='post_index_info_right'>
            <div class="post_index_user_name">
                <a><%=owner_user.name%><span> Â· </span></a>
            </div>

            <div class="post_index_user_follow" id="user_follow_<%=owner_user.id%>">
                <%if current_user.present?%>
                    <% pre_follow = current_user.following_users.find { |follow| follow.followee_id == current_user.id} %>
                <%end%>
                <% if pre_follow %>  
                    <%= button_to user_user_follow_path(owner_user, pre_follow, type_param: 'index'), method: :delete, remote: true do%>
                        <a>Followed</a>
                    <%end%> 
                <%else%>
                    <%= button_to user_user_follows_path(owner_user, type_param: 'index'), method: :post, remote: true do%>
                        <a>Follow</a>
                    <%end%>
                <%end%>
            </div>
            
            <div class="post_index_create">
                <span><%=time_ago_in_words(@post.created_at)%></span>
            </div>
        </div>
    </div>
    <div class='post_index_title'>
        <a><%= link_to (@post.title), post_path(@post) %></a>
    </div>
    
    <%if @post.image?%>
        <div class='post_index_image'>
            <%= link_to (image_tag(@post.image.url)), image_path(url_for(@post.image.url)), rel: "gallery" , :href => post_path(@post)%>
        </div>
    <%else%>
        <div class='post_index_content'>
            <a><%=@post.content%></a>
        </div>
    <%end%>

    <div class='post_index_tag_block'>
        <%@post.tags.each do |tag|%>
            <div class='post_index_tag_link'>
                <a><%= link_to ("#" + tag.name), tag_path(tag) %></a>
            </div>
        <%end%>
    </div>

    <div class="post_index_toolbar_block">
        <div class="post_index_vote_unvote_block" id="post_vote_unvote_<%=@post.id%>">
            <div class="post_index_vote_block">
                <%if current_user.present?%>
                    <% pre_vote = @post.post_votes.find { |vote| vote.user_id == current_user.id} %>
                <%end%>
                <% if pre_vote %>  
                    <%= button_to post_post_vote_path(@post, pre_vote, type_param: 'index'), method: :delete, remote: true do%>
                        <i><%= bootstrap_icon "arrow-up-circle-fill", width: 20, height: 20, fill: "#4f46e5" %></i>
                    <%end%> 
                <%else%>
                    <%= button_to post_post_votes_path(@post, type_param: 'index'), method: :post, remote: true do%>
                        <i><%= bootstrap_icon "arrow-up-circle", width: 20, height: 20, fill: "#888" %></i>
                    <%end%> 
                <%end%>
            </div>

            <div class="post_index_vote_unvote_count">
                <span><%=@post.post_votes.count - @post.post_unvotes.count%></span>
            </div>

            <div class="post_index_unvote_block">
                <%if current_user.present?%>
                    <% pre_unvote = @post.post_unvotes.find { |unvote| unvote.user_id == current_user.id} %>
                <%end%>
                <% if pre_unvote %>  
                    <%= button_to post_post_unvote_path(@post, pre_unvote, type_param: 'index'), method: :delete, remote: true do%>
                        <i><%= bootstrap_icon "arrow-down-circle-fill", width: 20, height: 20, fill: "#4f46e5" %></i>
                    <%end%> 
                <%else%>
                    <%= button_to post_post_unvotes_path(@post, type_param: 'index'), method: :post, remote: true do%>
                        <i><%= bootstrap_icon "arrow-down-circle", width: 20, height: 20, fill: "#888" %></i>
                    <%end%> 
                <%end%>
            </div>
        </div>

        <div class="post_index_comment_block">
            <%= button_to post_path(@post), method: :get, form_class: "post_index_comment" do%>
                <i><%= bootstrap_icon "chat", width: 18, height: 18, fill: "#666" %></i>
                <a><%= @post.post_comments.count%><span>Comments</span></a> 
            <%end%> 
        </div>

        <div class="post_index_follow_block" id="post_follow_<%=@post.id%>">
            <%if current_user.present?%>
                <% pre_follow = @post.post_follows.find { |follow| follow.user_id == current_user.id} %>
            <%end%>
            <% if pre_follow %>  
                <%= button_to post_post_follow_path(@post, pre_follow, type_param: 'index'), method: :delete, remote: true do%>
                    <i><%= bootstrap_icon "bookmark-fill", width: 20, height: 20, fill: "#4f46e5" %></i>
                    <span>Save</span>
                <%end%> 
            <%else%>
                <%= button_to post_post_follows_path(@post, type_param: 'index'), method: :post, remote: true do%>
                    <i><%= bootstrap_icon "bookmark", width: 20, height: 20, fill: "#888" %></i>
                    <span>Save</span>
                <%end%> 
            <%end%>
        </div>

        <div class="post_index_share_block">
            <%= button_to post_path(@post), method: :get, form_class: "post_index_share" do%>
                <i><%= bootstrap_icon "arrow-repeat", width: 22, height: 22, fill: "#666" %></i>
                <a><%= @post.post_comments.count%><span>Share</span></a> 
            <%end%> 
        </div>
    </div>

</div>